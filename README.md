**«Система мониторинга и управления IoT-устройствами SmartMonitor»**

Service High Level Design (HLD)

HLD_SMARTMON_2024

Версия: 1.0

# **СОДЕРЖАНИЕ** {#содержание .TOC-Heading}

[1 ВВЕДЕНИЕ [3](#_Toc98780375)](#_Toc98780375)

[1.1 Административная информация о документе
[3](#_Toc98780376)](#_Toc98780376)

[1.2 История изменений документа [3](#_Toc98780377)](#_Toc98780377)

[1.3 Термины, определения и сокращения
[3](#_Toc98780378)](#_Toc98780378)

[1.4 Назначение документа [4](#_Toc98780379)](#_Toc98780379)

[1.5 Связанные документы [4](#_Toc98780380)](#_Toc98780380)

[1.6 Связанные услуги [5](#_Toc98780381)](#_Toc98780381)

[2 ТЕХНИЧЕСКАЯ ПОСТАНОВКА ЗАДАЧИ [6](#_Toc98780382)](#_Toc98780382)

[3 ОПИСАНИЕ ТЕХНИЧЕСКОГО РЕШЕНИЯ [7](#_Toc98780383)](#_Toc98780383)

[3.1 Функциональность [8](#_Toc98780384)](#_Toc98780384)

[3.2 Системные требования для установки
[9](#_Toc98780385)](#_Toc98780385)

[3.3 Схема решения и описание схемы [9](#_Toc98780386)](#_Toc98780386)

[3.4 Описание системы резервного копирования
[9](#_Toc98780387)](#_Toc98780387)

[4 ЗАТРАТЫ НА РЕАЛИЗАЦИЮ [10](#_Toc98780388)](#_Toc98780388)

[5 РЕАЛИЗАЦИЯ РЕШЕНИЯ [11](#_Toc98780389)](#_Toc98780389)

[5.1 Стадии работ над проектом: instance -- часть. Трудозатраты
[11](#_Toc98780390)](#_Toc98780390)

[5.2 Стадии работ над проектом: SaaS -- часть. Трудозатраты
[13](#_Toc98780391)](#_Toc98780391)

[5.3 Ответственность заказчика [14](#_Toc98780392)](#_Toc98780392)

[6 МОНИТОРИНГ И SLA [15](#_Toc98780393)](#_Toc98780393)

1.  []{#_Toc98780375 .anchor}ВВЕДЕНИЕ

    1.  []{#_Toc98780376 .anchor}Административная информация о документе

  -------------------------------------- ------------- ---------- ---------------------------------
              **Должность**               **Подпись**   **Дата**      **ФИО**

             **Разработано:**                                     

   Разработчик программного обеспечения                            Иванов П.С.
   сектора по разработке инновационных                            
                 решений                                          

     Начальник сектора по разработке                               Петров А.В.
          инновационных решений                                   

      Технический архитектор отдела                               Сидоров К.Л.
     технической разработки продуктов                             

                                                                  

             **Согласовано:**                                     

      Руководитель дирекции сетевой                               Волков Д.М.
              инфраструктуры                                      

     Руководитель отдела по развитию                              Смирнова О.П.
                продуктов                                         

     Руководитель отдела технической                              Козлов М.А.
           разработки продуктов                                   

    Руководитель сектора по разработке                            Николаев С.И.
          инновационных решений                                   

      Руководитель сектора развития                               Захарова Е.В.
           клиентских отношений                                   

      Руководитель отдела поддержки                               Орлов В.Г.
          корпоративных клиентов                                  

      Руководитель отдела управления                              Белов А.С.
        интеллектуальными услугами                                

    Руководитель отдела информационной                            Кириллов П.М.
               безопасности                                       

     Менеджер по продуктам отдела по                              Соколова А.А.
            развитию продуктов                                    

      Технический архитектор отдела                               Сидоров К.Л.
     технической разработки продуктов                             

                   20.11.2024                                     
  -------------------------------------- ------------- ---------- ---------------------------------

    2.  []{#_Toc98780377 .anchor}История изменений документа

  -------------------------------------------------------------------------------------
  **Дата**   **Версия**   **Автор       **Текст замечания**    **Исправлено (описание
                          замечания /                          исправления, место в
                          должность**                          документе)**
  ---------- ------------ ------------- ---------------------- ------------------------
  20.11.2024 V1.0         Иванов П.С.                           Первая редакция
                          Разработчик                           
                          ПО                                    

  -------------------------------------------------------------------------------------

    3.  []{#_Toc98780378 .anchor}Термины, определения и сокращения

  ------------------ ----------------------------------------------------
  **Название**       **Расшифровка**

  IoT                Internet of Things - Интернет вещей

  MQTT               Message Queuing Telemetry Transport - протокол для 
                     обмена сообщениями между IoT-устройствами

  API                Application Programming Interface - программный 
                     интерфейс приложения

  VM                 Virtual Machine - виртуальная машина

  SaaS               Software as a Service - программное обеспечение как 
                     услуга

  FW                 Firewall - межсетевой экран

  SSL                Secure Sockets Layer - протокол безопасной связи

  RHEL               Red Hat Enterprise Linux

  HLD                High Level Design - высокоуровневый дизайн

  SLA                Service Level Agreement - соглашение об уровне 
                     обслуживания

  DB                 Database - база данных

  Zabbix             Система мониторинга

  Docker             Платформа для контейнеризации приложений

  VPN                Virtual Private Network - виртуальная частная сеть
  ------------------ ----------------------------------------------------

    4.  []{#_Toc98780379 .anchor}Назначение документа

В HLD описывается высокоуровневое представление системы мониторинга и управления IoT-устройствами SmartMonitor.

В текущей версии документа описывается сервис централизованного мониторинга, управления и аналитики для IoT-устройств различных производителей.

Назначение Сервиса - предоставление единой платформы для управления распределенными IoT-устройствами с функциями мониторинга в реальном времени, обработки данных и формирования аналитических отчетов.

Сервис предлагает функционал, позволяющий клиентам управлять тысячами IoT-устройств через веб-интерфейс, получать уведомления о критических событиях и анализировать исторические данные.

    5.  []{#_Toc98780380 .anchor}Связанные документы

  -------------- --------------------------------------------------------
  **Номер        **Название документа**
  документа**    

  TSD-001        Техническое задание на разработку системы SmartMonitor

  LLD-SM-2024    Low Level Design системы SmartMonitor v1.0

  API-SM-001     API документация системы SmartMonitor v1.2

  MANUAL-SM-001  Руководство администратора SmartMonitor v1.0

  SEC-POL-2024   Политика информационной безопасности v3.0
  -------------- --------------------------------------------------------

    6.  []{#_Toc98780381 .anchor}Связанные услуги

  ------- ----------- -------------------------------------------------------
   **№**     **Код    **Наименование услуги**
           услуги**   

     1       CLOUD-01  Облачная инфраструктура (IaaS)
     2       NET-02    Выделенный канал связи
     3       SEC-03    Сервис информационной безопасности
     4       BACKUP-04 Услуга резервного копирования
  ------- ----------- -------------------------------------------------------

2.  []{#_Toc98780382 .anchor}ТЕХНИЧЕСКАЯ ПОСТАНОВКА ЗАДАЧИ

Для реализации клиентских проектов необходимо разработать документ о типовых вариантах реализации и обслуживания подобных проектов, высокоуровневый дизайн этих вариантов.

В документе требуется предоставить данные:

- реализуемые функции: централизованный мониторинг IoT-устройств, управление конфигурацией, сбор и анализ телеметрии, генерация отчетов, уведомления о событиях;

- спецификации и лицензирование: требования к программному и аппаратному обеспечению, лицензии на используемое ПО;

- техническая схема реализации: архитектура системы, компоненты, взаимодействия;

- трудозатраты участвующих в реализации подразделений: оценка временных и человеческих ресурсов;

- условия оказания технической поддержки: уровни поддержки, время реакции, SLA.

3.  []{#_Toc98780383 .anchor}ОПИСАНИЕ ТЕХНИЧЕСКОГО РЕШЕНИЯ

Общее описание

Система SmartMonitor представляет собой масштабируемую платформу для мониторинга и управления IoT-устройствами. Решение построено на микросервисной архитектуре с использованием контейнеризации Docker. Система поддерживает основные протоколы IoT (MQTT, HTTP, CoAP) и предоставляет REST API для интеграции с внешними системами.

Архитектура системы включает следующие основные компоненты:

1. Шлюз приема данных - обработка входящих данных от устройств
2. Сервис обработки данных - бизнес-логика и обработка телеметрии
3. База данных - хранение конфигурации и исторических данных
4. Веб-интерфейс - панель управления для пользователей
5. Сервис уведомлений - отправка оповещений
6. Сервис отчетов - генерация аналитических отчетов

    1.  []{#_Toc98780384 .anchor}Функциональность

Функциональные возможности системы (списком):

- Мониторинг состояния IoT-устройств в реальном времени
- Управление конфигурацией устройств (удаленное обновление, настройка параметров)
- Сбор и хранение телеметрических данных с поддержкой временных рядов
- Настраиваемые правила генерации уведомлений (email, SMS, Telegram)
- Формирование аналитических отчетов по заданным параметрам
- Ролевая модель доступа с различными уровнями привилегий
- Поддержка нескольких протоколов связи (MQTT, HTTP REST, WebSocket)
- Интеграция с внешними системами через REST API
- Дашборды с настраиваемыми виджетами
- Геолокация устройств на интерактивной карте
- Журналирование всех операций для аудита
- Автоматическое обнаружение новых устройств
- Пакетное управление группами устройств
- Планировщик задач для автоматического выполнения операций

Подробная информация по работе с функционалом системы приведена в документах «SmartMonitor v1.0 Admin Manual» и «SmartMonitor v1.0 User Manual».

    2.  []{#_Toc98780385 .anchor}Системные требования для развертывания системы

Системные требования к ВМ:

- Процессор четырёхъядерный с тактовой частотой: 2.2 ГГц
- Оперативная память не менее: 16 Гб
- Дисковое пространство SSD: 100 Гб (в зависимости от объема данных)
- Сетевая карта: 1 Гбит/с
- Резервное питание: ИБП с автономностью 30 минут

Требования к ПО:

- Операционная система: RHEL 8.x или CentOS 8.x
- Docker Engine: версия 20.10+
- Docker Compose: версия 2.0+
- PostgreSQL: версия 13+
- Redis: версия 6.0+

Требования к оборудованию:

- Серверные стойки с системой охлаждения
- Источники бесперебойного питания
- Сетевое оборудование с поддержкой VLAN
- Резервные каналы связи

    3.  []{#_Toc98780386 .anchor}Схема решения и описание схемы

Схема предусматривает работу с облачной и гибридной инфраструктурой. Основные компоненты развертываются в приватном облаке заказчика с возможностью интеграции с публичными облачными сервисами для обработки больших данных.

Архитектурная схема включает:

1. Уровень устройств: IoT-устройства с различными протоколами связи
2. Уровень шлюзов: MQTT брокер, API Gateway
3. Уровень обработки: микросервисы в Docker-контейнерах
4. Уровень данных: кластер баз данных (PostgreSQL для основных данных, TimescaleDB для телеметрии)
5. Уровень представления: веб-приложение на React
6. Уровень мониторинга: Zabbix для инфраструктуры, встроенный мониторинг для бизнес-метрик

Все компоненты защищены межсетевым экраном с правилами сегментации сети.

    4.  []{#_Toc98780387 .anchor}Описание системы резервного копирования

Отказоустойчивость виртуальной машины и полное копирование, включая установленный сервер, конфигурацию и данные, обеспечиваются согласно политике резервного копирования компании.

Создание резервных копий для виртуальной машины настраивается по расписанию: ежедневные инкрементальные бэкапы в 02:00, полные еженедельные бэкапы в воскресенье в 03:00.

Прерывание сервиса во время бекапирования минимально за счет использования инкрементальных копий и технологии snapshot.

Для обеспечения непрерывности работы сервиса будет использоваться стратегия "3-2-1": три копии данных, на двух разных типах носителей, одна копия вне площадки.

4.  []{#_Toc98780388 .anchor}ЗАТРАТЫ НА РЕАЛИЗАЦИЮ

**Затраты на реализацию:**

+-----------------------+----------------------------------------------+
| **Описание**          | **Стоимость (Курс: 1 USD = 90 ₽ ; Дата формирования   |
|                       | цен: 20.11.2024)**                                  |
+-----------------------+----------------------------------------------+
| **Лицензии ПО**       | Разово: 18 127 ₽                             |
|                       +----------------------------------------------+
|                       | Ежемесячно: 8 747 ₽ (В год: 104 964 ₽)       |
+-----------------------+----------------------------------------------+
| **Облачная           | В год: 815 USD (В год: 73 350 ₽)             |
| инфраструктура**      |                                              |
+-----------------------+----------------------------------------------+
| **Техническая        | В год: 200 USD (В год: 18 000 ₽)             |
| поддержка**           |                                              |
+-----------------------+----------------------------------------------+

5.  []{#_Toc98780389 .anchor}РЕАЛИЗАЦИЯ РЕШЕНИЯ

Данная система разворачивается в инфраструктуре заказчика или в приватном облаке провайдера.

Исходя из чего, ниже описаны две категории работ:

1) Разовое разворачивание инстанса в инфраструктуре заказчика, где описаны работы по установке и настройке системы (подробнее в стадиях работ П5.1)

    1.  []{#_Toc98780390 .anchor}Стадии работ над проектом: instance -- часть. Трудозатраты

Перечисленные ниже работы относятся к разворачиванию инстанса в облаке.

+-------+------------------------------+------------------------------+-------------------------+
| **№** | **Выполняемая работа**       | **Ответственное              | **Трудозатраты,         |
|       |                              | подразделение**              | человеко-часы**         |
+:=====:+==============================+==============================+=========================+
|       |                              |                              |                         |
+-------+------------------------------+------------------------------+-------------------------+
| **1** | **Проектно-изыскательская работа**                                                    |
+-------+------------------------------+------------------------------+-------------------------+
|       | 1.1. Формирование требований | Отдел развития продуктов     | 8                       |
|       | к ресурсам ВМ                |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 1.2. Формирование требований | Сетевая инфраструктура       | 6                       |
|       | к сетевой инфраструктуре     |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 1.3. Выделение ресурсов под  | Облачная инфраструктура      | 4                       |
|       | размещаемую систему          |                              |                         |
+-------+------------------------------+------------------------------+-------------------------+
| **2** | **Инсталляционные работы**                                                            |
+-------+------------------------------+------------------------------+-------------------------+
|       | 2.1. Организация удаленного  | Сетевая инфраструктура       | 4                       |
|       | доступа к выделенным         |                              |                         |
|       | вычислительным ресурсам      |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 2.3. Установка ОС            | Техническая разработка       | 8                       |
|       +------------------------------+                              +-------------------------+
|       | 2.4. Установка               |                              | 6                       |
|       | Docker-окружения             |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 2.5. Разворачивание          |                              | 16                      |
|       | компонентов системы (внутри  |                              |                         |
|       | докер-окружения)             |                              |                         |
+-------+------------------------------+------------------------------+-------------------------+
| **3** | **Пусконаладочные работы**                                                            |
+-------+------------------------------+------------------------------+-------------------------+
|       | 3.1. Организация доступа к   | Мониторинг и эксплуатация    | 4                       |
|       | системе мониторинга Zabbix.  |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 3.2. Настройка генерации     |                              | 4                       |
|       | Zabbix                       |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 3.3. Настройка шаблонов      |                              | 8                       |
|       | мониторинга Zabbix           |                              |                         |
|       | триггеров, узлов связи       |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 3.4. Настойка в ИС карточки  | Техническая разработка       | 4                       |
|       | объекта                      |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 3.5.  Настройка схемы БД     |                              | 12                      |
|       +------------------------------+                              +-------------------------+
|       | 3.6.  Первоначальная         |                              | 8                       |
|       | настройка компонентов        |                              |                         |
|       | системы (загрузка            |                              |                         |
|       | справочников и т.д.)         |                              |                         |
|       +------------------------------+                              +-------------------------+
|       | 3.7.  Создание учётной       |                              | 2                       |
|       | записи                       |                              |                         |
|       | **мастер**-администратора    |                              |                         |
|       +------------------------------+                              +-------------------------+
|       | 3.8.  Реализация             |                              | 24                      |
|       | интеграционных               |                              |                         |
|       | взаимодействий (по запросу   |                              |                         |
|       | клиента)                     |                              |                         |
|       +------------------------------+                              +-------------------------+
|       | 3.9.  Проверка работы        |                              | 8                       |
|       | инсталлированной системы     |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 3.10. Настройка правил на FW | Сетевая инфраструктура       | 8                       |
+-------+------------------------------+------------------------------+-------------------------+
| **4** | **Проведение приемосдаточных испытаний**                                              |
+-------+------------------------------+------------------------------+-------------------------+
|       | 4.1.  Проверка доступности   | QA отдел                     | 4                       |
|       | (аккаунта, созданного        |                              |                         |
|       | **мастер**-администратора,   |                              |                         |
|       | функциональности             |                              |                         |
|       | администратора)              |                              |                         |
|       +------------------------------+                              +-------------------------+
|       | 4.2.  Проверка прохождения   |                              | 16                      |
|       | сценариев тестирования       |                              |                         |
|       +------------------------------+                              +-------------------------+
|       | 4.3.  Проверка успешности    |                              | 8                       |
|       | интеграционных               |                              |                         |
|       | взаимодействий               |                              |                         |
+-------+------------------------------+------------------------------+-------------------------+
| **5** | **Завершение работы по построению системы**                                           |
+-------+------------------------------+------------------------------+-------------------------+
|       | 5.1.  Подписание акта        | Руководство проекта          | 4                       |
|       | приёмки услуги (о завершении |                              |                         |
|       | работы и сдачи системы в     |                              |                         |
|       | эксплуатацию)                |                              |                         |
+-------+------------------------------+------------------------------+-------------------------+
| **6** | **Эксплуатация системы**                                                              |
+-------+------------------------------+------------------------------+-------------------------+
|       | 6.1.  Обновление ОС          | Техническая поддержка        | 4 (ежеквартально)       |
|       +------------------------------+------------------------------+-------------------------+
|       | 6.2.  Обновление компонентов |                              | 8 (ежемесячно)          |
|       | системы                      |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 6.3.  Мониторинг             | Мониторинг и эксплуатация    | 24/7                    |
|       | работоспособности ОС         |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 6.4.  Мониторинг             |                              | 24/7                    |
|       | работоспособности            |                              |                         |
|       | компонентов системы          |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 6.5. Продление лицензии на   | Закупки                      | 4 (ежегодно)            |
|       | поддержку RHEL Server        |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 6.6. Продление SSL           | Техническая поддержка        | 2 (ежегодно)            |
|       | сертификатов для домена      |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 6.7. Поддержка платформы     | Облачная инфраструктура      | 24/7                    |
|       | виртуализации и системы      |                              |                         |
|       | бэкапирования с процессом    |                              |                         |
|       | бэкапирования VM             |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 6.8 Решение проблем с        | Сетевая инфраструктура       | по запросу              |
|       | сетевым доступом на FW       |                              |                         |
|       +------------------------------+------------------------------+-------------------------+
|       | 6.9. Реагирование на события | Техническая поддержка        | 24/7                    |
|       | от данного сервера в         |                              |                         |
|       |                              |                              |                         |
|       | соответствии с применяемыми  |                              |                         |
|       | use case                     |                              |                         |
+-------+------------------------------+------------------------------+-------------------------+
|       | 6.10.  Выделение и           | Облачная инфраструктура      | по запросу              |
|       | обновление виртуальных       |                              |                         |
|       | ресурсов                     |                              |                         |
+-------+------------------------------+------------------------------+-------------------------+
|       | 6.11 Обработка событий       | Информационная безопасность  | по запросу              |
|       | безопасности                 |                              |                         |
+-------+------------------------------+------------------------------+-------------------------+
|       | **ИТОГО разовые работы**     |                              | **152 часа**            |
+-------+------------------------------+------------------------------+-------------------------+
|       | **ИТОГО эксплуатация**       |                              | **вариативно**          |
+-------+------------------------------+------------------------------+-------------------------+

    2.  []{#_Toc98780392 .anchor}Ответственность сторон

Ответственности сторон:

**Поставщик (исполнитель) обязуется:**

- Обеспечить установку и настройку системы согласно утвержденной спецификации
- Предоставить документацию по эксплуатации системы
- Обеспечить техническую поддержку в соответствии с SLA
- Информировать заказчика о плановых работах не менее чем за 72 часа
- Обеспечить конфиденциальность данных заказчика

**Заказчик обязуется:**

- Предоставить необходимую инфраструктуру для развертывания системы
- Назначить ответственных лиц для взаимодействия с исполнителем
- Своевременно предоставлять доступ к необходимым ресурсам
- Осуществлять оплату услуг в установленные сроки
- Соблюдать условия лицензионных соглашений используемого ПО

6.  []{#_Toc98780393 .anchor}МОНИТОРИНГ И SLA

Мониторинг производится с помощью системы Zabbix и встроенных инструментов мониторинга платформы.

Шаблон мониторинга: Инфраструктурный мониторинг

Перечень тестов:

  -----------------------------------------------------------------------
  **Тест**                    **Тип теста**  **Условие        **Период
                                             fail**          проверки**
  --------------------------- -------------- -------------- -------------
  Доступность веб-интерфейса  HTTP test      Код ответа ≠ 200  1 минута

  Загрузка CPU                Zabbix agent   > 90% 5 минут     1 минута

  Использование памяти        Zabbix agent   > 95%             1 минута

  Дисковое пространство       Zabbix agent   > 90%             5 минут

  Доступность БД              TCP check      Нет подключения   1 минута

  Доступность Docker          Zabbix agent   Сервис не активен 1 минута
  -----------------------------------------------------------------------

Шаблон мониторинга: Бизнес-мониторинг

Перечень тестов:

  ------------------------------------------------------------------------
  **Тест**                    **Тип теста**  **Условие         **Период
                                             fail**           проверки**
  --------------------------- -------------- -------------- --------------
  Количество активных         Custom script  Резкое падение >   5 минут
  устройств                                    50%

  Время обработки запроса     Custom script  > 5000 мс         5 минут

  Количество ошибок в логах   Log monitoring > 10 ошибок/мин   5 минут

  Доступность MQTT брокера    TCP check      Нет подключения   1 минута

  Задержка обработки данных   Custom script  > 1000 мс         5 минут

  Количество подключений      Zabbix agent   > 1000            1 минута

  Использование API           Custom script  Резкий рост >     5 минут
                                                200%

  Доступность внешних         HTTP test      Код ответа ≠ 200  5 минут
  интеграций

  Объем данных в БД           Custom script  > 90% от лимита   1 час

  Активность пользователей    Custom script  Нет активности    1 час
                                                24 часа
  ------------------------------------------------------------------------

**Соглашение об уровне обслуживания (SLA)**

**Доступность системы:** 99.5% в рабочее время (Пн-Пт 9:00-18:00), 99% в нерабочее время.

**Время реакции на инциденты:**
- Критические инциденты (полная недоступность): 15 минут
- Высокий приоритет (частичная недоступность): 1 час
- Средний приоритет (ограниченная функциональность): 4 часа
- Низкий приоритет (вопросы по функциональности): 24 часа

**Время восстановления:**
- Критические инциденты: не более 4 часов
- Высокий приоритет: не более 8 часов
- Средний приоритет: не более 24 часов

**Техническое обслуживание:** Плановые работы проводятся в выходные дни с 00:00 до 06:00 с предварительным уведомлением за 72 часа.

**Отчетность:** Ежемесячный отчет о доступности системы и выполнении SLA предоставляется до 5-го числа следующего месяца.
